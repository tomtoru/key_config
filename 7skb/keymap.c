#include QMK_KEYBOARD_H
#include "keymap_jp.h"

#ifdef RGBLIGHT_ENABLE
//Following line allows macro to read current RGB settings
extern rgblight_config_t rgblight_config;
#endif

extern uint8_t is_master;

// Each layer gets a name for readability, which is then used in the keymap matrix below.
// The underscores don't mean anything - you can have a layer called STUFF or any other name.
// Layer names don't all need to be of the same length, obviously, and you can also skip them
// entirely and just use numbers.

#define _QWERTY 0
#define _LOWER 1
#define _RAISE 2
#define _ADJUST 3

enum custom_keycodes {
  QWERTY = SAFE_RANGE,
  LOWER,
  RAISE,
  ADJUST,
};


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_QWERTY] = LAYOUT(
  //,---------------------------------------------------------------------------------------------------|        |--------------------------------------------------------------------------------------------------------------------------------------------------------|
         KC_ESC,       JP_1,         JP_2,            JP_3,          JP_4,          JP_5,                     JP_6,            JP_7,          JP_8,           JP_9,           JP_0,       JP_MINS,    JP_CIRC,     JP_YEN,     KC_BSPC,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------+---------------|
       KC_TAB,        KC_Q,        KC_W,           KC_E,         KC_R,        KC_T,                     KC_Y,           KC_U,         KC_I,          KC_O,         KC_P,       JP_AT,          JP_LBRC,    KC_DEL,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------|
     KC_LCTRL,     KC_A,         KC_S,           KC_D,         KC_F,         KC_G,                   KC_H,           KC_J,          KC_K,         KC_L,      JP_SCLN,    KC_QUOT,   KC_ENT,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
      KC_LSFT,       KC_Z,         KC_X,           KC_C,         KC_V,         KC_B,                   KC_N,           KC_M,     JP_COMM,  JP_DOT,     JP_SLSH,    KC_RSFT,   XXXXXXX,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
                                    KC_LALT,     KC_LGUI,  LT(1, KC_LANG2),  KC_SPC,            KC_ENT,    LT(2, KC_LANG1), KC_BSPC, KC_RALT 
                                          //|---------------+---------------+---------------+---------------|        |---------------+---------------+---------------+---------------|  
  ),

  [_LOWER] = LAYOUT(
  //,---------------------------------------------------------------------------------------------------|        |--------------------------------------------------------------------------------------------------------------------------------------------------------|
      _______,       KC_F1,         KC_F2,        KC_F3,        KC_F4,        KC_F5,               KC_F6,         KC_F7,       KC_F8,          KC_F9,      KC_F10,     KC_F11,      KC_F12,       _______,      _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------+---------------|
      _______,      _______,    KC_HASH,   KC_DLR,   KC_PERC, LSFT(JP_6),         JP_MINS,        KC_7,          KC_8,           KC_9,        _______,     _______,     _______,      _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------|
      _______,      _______,    KC_HASH,   KC_DLR,   KC_PERC,   JP_LPRN,           JP_RPRN,      KC_4,          KC_5,           KC_6,        JP_PLUS,    _______,     _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
      _______,      _______,    JP_LBRC,   JP_RBRC,  LSFT(JP_2),LSFT(JP_7),        JP_UNDS,      KC_1,          KC_2,          KC_3,       KC_COMM,   _______,     _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
                                               _______,     _______,     _______,     _______,             _______,       KC_0,        _______,      _______ 
                                          //|---------------+---------------+---------------+---------------|        |---------------+---------------+---------------+---------------|  
  ),

  [_RAISE] = LAYOUT(
  //,---------------------------------------------------------------------------------------------------|        |--------------------------------------------------------------------------------------------------------------------------------------------------------|
      _______,      _______,     _______,     _______,     _______,     _______,        LCTL(KC_D), LCTL(KC_E),  _______,     _______,      _______,   KC_MPLY,   KC_MUTE,   KC_VOLD,   KC_VOLU,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------+---------------|
      _______,      _______,     _______,     _______,     _______,     _______,              _______,     _______,     _______,     _______,      _______,     _______,     _______,      _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------|
      _______,      _______,     _______,     _______,     _______,     _______,            KC_LEFT,   KC_DOWN,     KC_UP,    KC_RGHT,     _______,     _______,     _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
      _______,      _______,     _______,     _______,     _______,     _______,              _______,     _______,     _______,     _______,      _______,     _______,     _______,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
                                               _______,     _______,     _______,     _______,              _______,     _______,     _______,     _______ 
                                          //|---------------+---------------+---------------+---------------|        |---------------+---------------+---------------+---------------|  
  ),

  [_ADJUST] = LAYOUT( /* Base */
  //,---------------------------------------------------------------------------------------------------|        |--------------------------------------------------------------------------------------------------------------------------------------------------------|
  TG(_ADJUST), XXXXXXX, XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,          XXXXXXX,    XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,   XXXXXXX,   XXXXXXX,     RESET,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------+---------------|
      XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,          XXXXXXX,    XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,   XXXXXXX,   XXXXXXX,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------+----------------|
      XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,          XXXXXXX,    XXXXXXX,  XXXXXXX,  XXXXXXX,   XXXXXXX,  XXXXXXX,   XXXXXXX,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
      XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,           RGB_VAD,    RGB_VAI,   RGB_HUD,  RGB_HUI,  RGB_SAD,   RGB_SAI,   XXXXXXX,
  //|---------------+---------------+---------------+---------------+---------------+---------------|        |---------------+----------------+---------------+---------------+---------------+---------------+----------------|
                                             XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX,           XXXXXXX,   XXXXXXX,  KC_STOP,   XXXXXXX 
                                          //|---------------+---------------+---------------+---------------|        |---------------+---------------+---------------+---------------|  
  )
};


//A description for expressing the layer position in LED mode.
layer_state_t layer_state_set_user(layer_state_t state) {
#ifdef RGBLIGHT_ENABLE
    switch (get_highest_layer(state)) {
    // case _FN:
    //   rgblight_sethsv_at(HSV_BLUE, 0);
    //   break;
    case _ADJUST:
      rgblight_sethsv_at(HSV_PURPLE, 0);
      break;
    default: //  for any other layers, or the default layer
      rgblight_sethsv_at( 0, 0, 0, 0);
      break;
    }
    rgblight_set_effect_range( 1, 4);
#endif
return state;
}

int RGB_current_mode;
bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
    case QWERTY:
      if (record->event.pressed) {
        set_single_persistent_default_layer(_QWERTY);
      }
      return false;
      break;
    case LOWER:
      if (record->event.pressed) {
        layer_on(_LOWER);
      } else {
        layer_off(_LOWER);
      }
      return false;
      break;
    case RAISE:
      if (record->event.pressed) {
        layer_on(_RAISE);
      } else {
        layer_off(_RAISE);
      }
      return false;
      break;
    case ADJUST:
        if (record->event.pressed) {
          layer_on(_ADJUST);
        } else {
          layer_off(_ADJUST);
        }
        return false;
        break;
  }
  return true;
}
